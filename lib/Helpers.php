<?php

namespace NPF;

use DateTime;

class Helpers
{
    /*
 * Данные для исправления ошибки возникшей при первых запусках бота
 * (до разработки от Креатив) убрать нельзя, так как некоторые АП все еще исполняются
 *
 * UF_CLIENTID_FOND => UF_CLIENTID_BANK,UF_GUID_AP
 */
    protected $clientIDReplasement = [
        '999-9003-000039132' => [8968, 'E7175FB8-C8DF-4114-A855-7055228D73D5'],
        '999-9003-000039120' => [8956, '3310EB6B-0925-480D-B58A-BE4812F881C8'],
        '999-9003-000039116' => [8952, '181F9812-1A98-4623-8B86-A59B5638FC3E'],
        '999-9003-000039071' => [8907, 'D63FA921-A241-44E1-9572-EB956DCEADA3'],
        '999-9003-000039059' => [8895, '3D4FE77F-6EA9-4406-9F0B-B9B75FC57F18'],
        '999-9003-000038983' => [8819, 'F7F65A2A-314F-459F-98A0-2B31FDE73B34'],
        '999-9003-000038914' => [8750, '34CF6FEB-554C-49DF-836E-9E40997F8FA7'],
        '999-9003-000038883' => [8719, '356087F1-9A7A-456C-B700-01A3AC5B145D'],
        '999-9003-000038874' => [8710, 'F6F97FA3-E351-47B1-9A72-FEA9EF9FA067'],
        '999-9003-000038777' => [8613, 'C70BCA84-C84A-4D1A-96F2-CC2C64751DA1'],
        '999-9003-000038767' => [8603, '6E2F406D-ACC3-45A9-ADF4-717E70AF9FAD'],
        '999-9003-000038734' => [8570, '08A225E1-39F7-4D89-B443-571BFCF61056'],
        '999-9003-000038733' => [8569, '7596ADEC-4EBE-4D87-BFE0-3DC3594FF9E6'],
        '999-9003-000038664' => [8500, '19EC6F75-A103-40A4-8F8A-833D2F451943'],
        '999-9003-000038651' => [8487, '9F71BB2A-246A-4CBA-92F9-D7D6A2AFBE4B'],
        '999-9003-000038545' => [8381, 'CF8A1CDB-A06C-456D-86EA-9EAC8C4F3B75'],
        '999-9003-000038509' => [8345, '90BD4A18-7D45-4880-904C-1F554F230942'],
        '999-9003-000038454' => [8290, '972B9679-EBE5-413D-BE15-1A66D8DC2F5F'],
        '999-9003-000038410' => [8246, '6F4CDCE2-B61A-4CDD-BFBF-DFA3077BF39A'],
        '999-9003-000038361' => [8197, '4A175114-FEE8-4C49-BB0F-6C1AA97EC408'],
        '999-9003-000038312' => [8148, '0CDEF17F-0BCC-422E-89EA-A3D3C55602A0'],
        '999-9003-000038291' => [8127, 'A45AB486-5316-4F63-A54C-6079D6FDD355'],
        '999-9003-000038235' => [8071, 'CBA39668-791B-4A10-8AC8-0A8BB6B03726'],
        '999-9003-000038133' => [7969, '30FF4BDF-92F7-4D97-A1C6-EE51C92929E1'],
        '999-9003-000038116' => [7952, 'F058DFB2-333B-4DE5-B1E8-2E9CB11A071B'],
        '999-9003-000038109' => [7945, 'CF0777E7-A0BE-48F4-9CC8-FDBDF318814D'],
        '999-9003-000038096' => [7932, '23D75888-CD46-416E-A820-19567F2BDD15'],
        '999-9003-000038081' => [7917, '49D60A78-AA32-47AF-AE1E-985ECB25B59C'],
        '999-9003-000038075' => [7911, 'DD5212EE-7CCF-4562-A7B1-0A95BC040315'],
        '999-9003-000038067' => [7903, '105F4F97-F5AA-4E68-A103-99D79C0959D3'],
        '999-9003-000037941' => [7777, '1731FA15-F18D-4607-82A0-711E95AFEE71'],
        '999-9003-000037920' => [7756, 'C7645ADA-4C36-481C-9441-D3C02AE3736F'],
        '999-9003-000037868' => [7704, 'E442B518-2E41-46A8-A088-8C12B7C66B30'],
        '999-9003-000037845' => [7681, 'DF8678AD-A392-4186-8B57-26CCC24E460B'],
        '999-9003-000037837' => [7673, 'BA2D23BE-C2B1-4CF1-B0B5-E79C613DDCEB'],
        '999-9003-000037785' => [7621, '01B879FA-1566-4044-A43F-687C4D028060'],
        '999-9003-000037772' => [7608, 'CC098ACB-8A6D-4D82-A0DD-9FD88A5B4ABD'],
        '999-9003-000037767' => [7603, '652028F9-D886-4DB7-8BCB-F63CB8A8C645'],
        '999-9003-000037758' => [7594, '95871886-C77A-4BCF-889E-A7C3F5B4AA7B'],
        '999-9003-000037752' => [7588, '9BF87D30-B2A4-4B15-938B-96954634378D'],
        '999-9003-000037705' => [7541, 'B479AADA-076B-46C1-A640-310388B1F77C'],
        '999-9003-000037690' => [7526, 'B725CA50-D491-4E65-8E87-0D39252A4347'],
        '999-9003-000037688' => [7524, '9E3F4EEC-093E-4F08-B07B-45A8FAF8AA15'],
        '999-9003-000037668' => [7504, '94C3CD81-E3D0-40BA-875B-B6BF89A361E5'],
        '999-9003-000037666' => [7502, '4DF1FE94-BC60-4F91-B503-76AA25E815F8'],
        '999-9003-000037644' => [7480, 'A30C260C-56FD-402A-9E3A-BB2945A4A9E9'],
        '999-9003-000037601' => [7437, 'ED1CF41A-5076-446C-A254-0666DA596602'],
        '999-9003-000037472' => [7308, '86807255-8618-4E10-92B2-D0B59A23B6B6'],
        '999-9003-000037428' => [7264, 'E71EAC3F-F71D-45D5-BB6D-06CA6E5D51AC'],
        '999-9003-000037416' => [7252, '202BF4FC-BF32-41CA-B954-0F2A23AAD20E'],
        '999-9003-000037373' => [7209, 'E58F75AB-4DAB-4B83-9D13-84D2B9B741AD'],
        '999-9003-000037359' => [7195, '4ABD39A5-C06A-4686-BF6B-8CCD31A954EC'],
        '999-9003-000037347' => [7183, '4F1393C5-6747-4E9F-B107-9F048AF0A304'],
        '999-9003-000037325' => [7161, '48F07567-4B19-44BD-BDA4-0773DF4290DE'],
        '999-9003-000037321' => [7157, '12088EB5-742A-405F-83D7-EA02F5943769'],
        '999-9003-000037300' => [7136, 'A18604B5-3E06-4F01-8F82-EE2BCAEE4627'],
        '999-9003-000037288' => [7124, '356E2F39-A656-451A-A3ED-4A29FDB47F0B'],
        '999-9003-000037211' => [7047, 'BA7E79CC-125E-4976-88A7-2E0B63CCD0F0'],
        '999-9003-000037205' => [7041, '33229723-AC39-4B76-8349-614724E07E6E'],
        '999-9003-000037202' => [7038, 'E0C1F95F-57FD-4231-9407-06CF0B6E3CDD'],
        '999-9003-000037142' => [6978, '947E5C23-90EB-4B59-A9E2-A183FB7D1C6D'],
        '999-9003-000037078' => [6914, '38C0D5BE-F445-4044-8416-41E0DB603DEF'],
        '999-9003-000037069' => [6905, '605F0C7D-B4E0-47AB-A824-ED2A8ADC4A06'],
        '999-9003-000037061' => [6897, 'D69B4ED7-243A-4D4E-96E4-7AAB5EEED1A9'],
        '999-9003-000037042' => [6878, '2A4E6E7A-7488-43B0-B40B-62DB75754B0A'],
        '999-9003-000037017' => [6853, '2B582F7F-E49C-4EEE-B485-CB01EF22AAA6'],
        '999-9003-000036995' => [6831, 'E6E24CA5-C87D-4407-B6DB-B05E46320CF7'],
        '999-9003-000036979' => [6815, '776F4147-5556-4EEA-800F-6296B863FC91'],
        '999-9003-000036950' => [6786, '89A9FE66-4947-4F50-9425-F853CD7F9F76'],
        '999-9003-000036894' => [6730, '4FD6F878-F77F-46F0-A2C2-0B1C055121FD'],
        '999-9003-000036877' => [6713, 'CD15497F-E8B9-487E-A5BC-CE5367FE8A48'],
        '999-9003-000036861' => [6697, 'E9A28A2F-52DB-4FD6-9C87-2747CD11C183'],
        '999-9003-000036682' => [6518, '564453D7-60FB-4C81-A788-38CD4E31DF69'],
        '999-9003-000036672' => [6508, 'DB73BB21-C604-453C-83CF-A048B738E792'],
        '999-9003-000036575' => [6411, '9FB061CB-7EA0-4A7B-A814-4B133768236C'],
        '999-9003-000036491' => [6327, '1D9F4566-BF3D-4BB0-B6AF-974BDECB2496'],
        '999-9003-000036338' => [6174, 'EAFEE1C4-C181-4862-A698-1D50D70BAF27'],
        '999-9003-000036299' => [6135, '3C735D41-55F6-4179-AFAC-3A20344CEFC9'],
        '999-9003-000036290' => [6126, '0F59E171-CDE6-4BA6-AB56-2BAB7BF7CA04'],
        '999-9003-000036238' => [6074, 'B245415D-10A4-4AA1-8C4B-84758BB3712B'],
        '999-9003-000036234' => [6070, '54842A8B-3B04-4A51-9E01-0A598541806B'],
        '999-9003-000036233' => [6069, '6CF55BF0-6BC1-46B2-AA59-E2E67E390D50'],
        '999-9003-000036161' => [5997, '2F5A8A6A-5FB2-4740-BC10-2232FE8A0CAF'],
        '999-9003-000036138' => [5974, '98170701-CC10-4DB0-AE29-F315446C3A8B'],
        '999-9003-000036136' => [5972, '20B84B76-A187-4337-B029-E4BF163A8D8A'],
        '999-9003-000036047' => [5883, 'A92541DD-66FA-4DA1-BCF8-6313516D9739'],
        '999-9003-000036044' => [5880, 'BF1A853D-E1AB-4721-96CA-DDA2DD4E9A7A'],
        '999-9003-000036035' => [5871, 'A198DBD7-3767-4338-993B-055451021EEA'],
        '999-9003-000035762' => [5598, 'FE8E7C4D-8631-4952-8009-3493D3E409DA'],
        '999-9003-000035746' => [5582, 'E92D7A41-5EF0-4DC3-B16D-A80E8EF396E7'],
        '999-9003-000035713' => [5549, '0FC0571A-011D-4401-97A1-51B53CFD07DA'],
        '999-9003-000035565' => [5401, 'A74E07E3-3A90-4EC0-A8B2-D0AE2417A638'],
        '999-9003-000035558' => [5394, 'D18F051E-0FF8-4A81-A52F-1D9C49054E54'],
        '999-9003-000035498' => [5334, '5C248AF1-03BF-4A4B-BF3B-F1B87DC7BE94'],
        '999-9003-000035348' => [5184, 'E028BAE9-0506-4452-80FD-FAA12412A5B8'],
        '999-9003-000035319' => [5155, '91945D24-04A4-47EE-BBFF-9529A8529830'],
        '999-9003-000035310' => [5146, 'E6493071-B8FB-4FB1-851C-59446CB415D6'],
        '999-9003-000035213' => [5049, '0EB2EC95-1E0B-4FB1-AC29-1D11086FECFC'],
        '999-9003-000035068' => [4904, 'BDEFA958-6F36-412A-BE74-1B60B753BC89'],
        '999-9003-000035043' => [4879, 'A633B47F-F1BE-4582-8590-52C25F4B3204'],
        '999-9003-000035017' => [4853, 'FEE64C69-6FA9-40F8-B608-FA5772940E9E'],
        '999-9003-000034883' => [4719, 'C3632D1C-25F8-4F07-AA5C-D80B3D1BFD46'],
        '999-9003-000034870' => [4706, '1695F52F-26BB-40D8-9963-D8D9C48EA476'],
        '999-9003-000034758' => [4594, '4645937F-0869-4CD7-8783-FB2C77E66AD9'],
        '999-9003-000034744' => [4580, '8AD29151-3CA8-4094-82F2-58FB2F65A88F'],
        '999-9003-000034733' => [4569, '4B037B8D-C70C-4B58-A4EF-104AAE74B60F'],
        '999-9003-000034679' => [4515, '8782CB00-AF3F-4171-8444-C656E3AC0A2E'],
        '999-9003-000034572' => [4408, '58F074F2-E0E3-4E4E-8F11-DA700E45336E'],
        '999-9003-000034507' => [4343, '68CD4974-4F0E-4A55-A564-5C420CC92E1E'],
        '999-9003-000034479' => [4315, '278BAE69-8141-4A76-B4C2-5E4FA682E426'],
        '999-9003-000034402' => [4238, '6D659F65-9E0B-47AA-A675-206B36F17454'],
        '999-9003-000034316' => [4152, '8E8FFCCC-68AC-4F63-A3EB-A7EA45910989'],
        '999-9003-000034239' => [4075, '1C6885B8-F668-4F2F-890D-A1DFE43D2DAB'],
        '999-9003-000034218' => [4054, 'DD6E1A23-42EA-4AA2-AC34-BF88E3E80B20'],
        '999-9003-000034179' => [4015, '7FE76C90-55D8-4861-B9B9-9BAB284C9D44'],
        '999-9003-000034178' => [4014, '43815728-FC71-4647-8B55-367915144B0F'],
        '999-9003-000034026' => [3862, 'E9A4FF73-5B1D-42E6-B596-55779FE619D6'],
        '999-9003-000033976' => [3812, 'FD989389-2F75-4261-9D1D-9833E218CCDA'],
        '999-9003-000033913' => [3749, '3DE66364-00D8-486E-BAE5-637DFCE8FC81'],
        '999-9003-000033802' => [3638, '867B98B6-C066-4949-BFE0-4AD7531B16EE'],
        '999-9003-000033709' => [3545, '36A127C0-A9FE-4BD1-84E4-D5452E521877'],
        '999-9003-000033705' => [3541, '26B624D6-CAA7-48CB-A345-1BB94A77ECE7'],
        '999-9003-000033535' => [3371, '2536FD38-8EAE-452B-A32F-311A3C90E6DF'],
        '999-9003-000033533' => [3369, '53BC5781-5C1F-4D1D-95E9-80A77CEEF374'],
        '999-9003-000033512' => [3348, '9D7AEDCC-49CD-4C8B-8EAB-9DAC2661388F'],
        '999-9003-000033466' => [3302, '3F391DFE-17C0-4A68-B5D3-361E2DC5B1E4'],
        '999-9003-000033400' => [3236, 'EABFB8F9-721A-4820-BEE1-FDF2D442B314'],
        '999-9003-000033320' => [3156, '7CE24D55-B1C4-4100-9A81-2B8FBB0FD7EE'],
        '999-9003-000033316' => [3152, '5B03B373-E920-4BA8-8316-30BA3BF9F003'],
        '999-9003-000033196' => [3032, '2C1681A4-53B2-4576-8DC3-520A990D7F00'],
        '999-9003-000033191' => [3027, '79AC073C-518A-4389-AF21-F919342F9398'],
        '999-9003-000033184' => [3020, '8FBF9E06-C2E9-4EEE-9ADE-CC6948FBB96D'],
        '999-9003-000033122' => [2958, '7F6686C5-0E3A-4D20-9125-413A3470ACB0'],
        '999-9003-000033114' => [2950, 'A66CE446-C05A-4B8A-A37B-76FC42D96E7A'],
        '999-9003-000033093' => [2929, '36326C24-0815-4198-807C-98A8EC8B89FE'],
        '999-9003-000033005' => [2841, '38A9D02F-D387-4DD5-AA12-866E7D5C71AD'],
        '999-9003-000032924' => [2760, '37A9F335-A964-473D-9342-5A356E02B305'],
        '999-9003-000032905' => [2741, '396B7200-1898-46F2-BF27-BFFF90997D1F'],
        '999-9003-000032840' => [2676, 'EE041B61-67F5-424C-BD88-567010ADC94E'],
        '999-9003-000032799' => [2635, '0AD21EF7-EABC-49D9-934C-15B309DF91FF'],
        '999-9003-000032706' => [2542, '6F37A738-563A-4BDF-9B5C-42194548454B'],
        '999-9003-000032689' => [2525, 'E7EFB87D-12D7-497A-99D1-FCAF2EF7AAC3'],
        '999-9003-000032679' => [2515, 'CDD8ABEF-B119-4B72-8B7E-7DAE86720372'],
        '999-9003-000032673' => [2509, 'B18CEB44-0B23-4CA0-8B63-72E3BBFE3F03'],
        '999-9003-000032614' => [2450, 'A6D40E48-FE11-4D3A-81E2-4E02F85B38BE'],
        '999-9003-000032600' => [2436, '76301888-1484-4F4C-BE34-46D14E75F981'],
        '999-9003-000032571' => [2407, '7346E694-6EA9-4384-8899-EF4142B43699'],
        '999-9003-000032566' => [2402, '972C87FC-CFE4-487E-99F1-3751C4BBBF6A'],
        '999-9003-000032496' => [2332, '592274CF-740F-44F3-9689-0119609DF15A'],
        '999-9003-000032452' => [2288, 'E00D485C-178A-43AB-A0B2-5EC1D2502F9C'],
        '999-9003-000032451' => [2287, 'E714D324-72B8-4009-9DDE-19429B971574'],
        '999-9003-000032419' => [2255, 'C30177D5-39F4-4E3A-B8B2-784C87CD8216'],
        '999-9003-000032413' => [2249, '265F2A0B-7B67-462E-B273-D3F7CB54F217'],
        '999-9003-000032385' => [2221, 'ED37BBF4-5F99-4196-BDF9-AC154715DF79'],
        '999-9003-000032346' => [2182, '1E2A1A29-EB2D-4C3C-B4B9-277CFB2451BF'],
        '999-9003-000032312' => [2148, '095E4680-6514-4F5E-9C9C-80C1C3B9FD19'],
        '999-9003-000032233' => [2069, '3AF9CDB8-5DBB-407A-86E4-2E72D521FFA8'],
        '999-9003-000032138' => [1974, '7B124246-E111-419D-A3EE-387A3F40D55E'],
        '999-9003-000032066' => [1902, 'D517C27C-75FC-4E21-8529-B8749B9087E5'],
        '999-9003-000032023' => [1859, 'D6C8B1BD-A206-4C78-B3C5-23D99CE61847'],
        '999-9003-000031984' => [1820, '180BD1F7-A043-42DD-9110-3A5131AB253E'],
        '999-9003-000031983' => [1819, '4D851BD9-CD3E-4D05-A5BB-1D505956864B'],
        '999-9003-000031830' => [1666, 'E3C2C540-18D8-48BE-AC52-B2CFAD864F2A'],
        '999-9003-000031747' => [1583, '3525F5B8-967E-4AB9-8B25-68295C70EF3D'],
        '999-9003-000031713' => [1549, '1882A7D6-35BC-409F-AF50-C48DD7A2E37B'],
        '999-9003-000031613' => [1449, '2FB9994C-9A65-4CF3-BB5B-21696A118F6D'],
        '999-9003-000031605' => [1441, '3D2B87F1-5795-4AEB-9A64-5BAC213E4221'],
        '999-9003-000031581' => [1417, '3EDC6D79-6B2B-42A2-840E-CC843180F747'],
        '999-9003-000031544' => [1380, '0FC4AE3D-5B66-4D6F-80E6-0B5DDC60EA70'],
        '999-9003-000031528' => [1364, 'A91985D2-9113-43C9-B772-5C887C8FE0F3'],
        '999-9003-000031417' => [1253, '62C31426-AA2B-4F4F-B2DA-A13805A47D51'],
        '999-9003-000031407' => [1243, '91A0DF3C-BF6A-4C7F-9434-A21305C13D96'],
        '999-9003-000031308' => [1144, '30805EC9-C311-4203-8DA2-025386E309B7'],
        '999-9003-000031293' => [1129, 'C90AE875-E721-47D7-8D65-29B2D8FC2C8F'],
    ];

    /*
     * Статусы при которых автоплатеж всегда отключается
     */
    protected $deactivateStatus = [
        -2012,  // Операция не поддерживается
        -2011,  // 3d secure( платеж без подтверждения запрещен)
        -2006,  // 3d secure
        -2000,  // Карта в черном списке
        1,      // Транзакция без подтверждения личности запрещена
        100,    // Запрещены интернет-транзакции
        111,    // неверный номер карты
        120,    // Данный тип транзакции невозможен для данной карты
        208,    // Карта утеряна
        902,     // Транзакция запрещена
        101,     //Операция отклонена
    ];

    /*
     * Статусы при которых делается пропуск ошибки
     * УСТАРЕЛО: заменено списком обязательного отключения
     */
    protected $skipStatus = [
        0,      //Approved
        121,    //Decline. Excds wdrwl limt
        -2010,  //Mismatching of XID
        123,    //Decline. Excds wdrwl ltmt
        209,    //Decline. Card limitations exceeded
        902,    //Decline. Invalid trans
        903,    //Decline. Re-enter trans
        116,    //Decline. Re-enter trans
    ];

    /**
     * Делает проверку на наличие ошибки с clientID и возвращает нужное значение.
     *
     * @param $contractNumber
     * @param $autopayGUID
     *
     * @return mixed
     */
    public function getClientIdReplacement($contractNumber, $autopayGUID)
    {
        $return = $contractNumber;

        if (isset($this->clientIDReplasement[$contractNumber]) && ($this->clientIDReplasement[1] == $autopayGUID)) {
            $clientId = $this->clientIDReplasement[0];
        }

        return $return;
    }

    /**
     * Определяет нужно отключить автоплатеж или нет
     *
     * @param $actionCode - код статуса ответа
     *
     * @return bool true/false : true - отключать, false - не отключать
     */
    public function getDeactivateStatus($actionCode)
    {
        $return = false;
        if (in_array($actionCode, $this->deactivateStatus)) {
            $return = true;
        }

        return $return;
    }

    /**
     * Вычисляет время до которого будет активна регистрация.
     *
     * @return string
     */
    public function getExpirationDate()
    {
        $date = new DateTime();
        $date->add('1D');

        return $date->format(DATE_ISO8601);
    }
}
